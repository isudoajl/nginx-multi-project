# Security settings
# Rate limiting zone - limits clients to 10 requests per second
limit_req_zone $binary_remote_addr zone=projectlimit:10m rate=10r/s;
limit_conn_zone $binary_remote_addr zone=projectconn:10m;

# Apply rate limiting to all locations
limit_req zone=projectlimit burst=20 nodelay;
limit_conn projectconn 20;

# Block common malicious bot user agents
map $http_user_agent $bad_bot {
    default 0;
    ~*(nmap|nikto|sqlmap|arachni|dirbuster|gobuster|w3af|nessus|masscan|ZmEu|zgrab) 1;
    ~*(python-requests|python-urllib|python-httpx|go-http-client|curl|wget) 1;
    "" 1; # Empty user agent
}

# Block requests with unusual HTTP methods
map $request_method $method_allowed {
    default 1;
    ~*(TRACE|TRACK|DEBUG) 0;
}

# Note: if directives for bad_bot and method_allowed are applied in server blocks
# See nginx.conf server block for implementation

# Note: Location-based security rules moved to server context in nginx.conf
# WordPress and vulnerability scanning protection implemented in main server block
